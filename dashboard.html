<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dashboard â€¢ Ground Handling Log</title>
<link rel="stylesheet" href="style.css"/>
</head>
<body>

<div class="container" style="padding-bottom:72px">
  <h2>ğŸ“Š Dashboard</h2>

  <div class="card" id="profile">Lade Profilâ€¦</div>

  <div class="row">
    <div class="stat"><div class="big" id="f">0</div><div class="label">Abfertigungen</div></div>
    <div class="stat"><div class="big" id="d">0</div><div class="label">Gesamt-Delay</div></div>
    <div class="stat"><div class="big" id="a">0</div><div class="label">Ã˜ Delay</div></div>
    <div class="stat"><div class="big" id="s">0â­</div><div class="label">Score</div></div>
  </div>

  <div class="card">
    <button id="logout" class="btn-secondary">Logout</button>
  </div>
</div>

<nav>
  <button class="active" data-go="dashboard.html">ğŸ“Š</button>
  <button data-go="flights.html">ğŸ›«</button>
  <button data-go="aircraft.html">âœˆï¸</button>
  <button data-go="album.html">ğŸ´</button>
  <button data-go="social.html">ğŸ‘¥</button>
</nav>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, doc, getDoc }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCC9zB_me4qdyBmHZ0TeUDPB1WoPNa6e1A",
  authDomain: "ground-handling-log.firebaseapp.com",
  projectId: "ground-handling-log",
  appId: "1:771821879817:web:35ad14da4ab4613b832ed8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

onAuthStateChanged(auth, async user=>{
  if (!user){ location.href="index.html"; return; }

  const snap = await getDoc(doc(db,"users",user.uid));
  const u = snap.data();
  const s = u.stats || {};

  profile.innerHTML = `
    <strong>${u.name}</strong><br>
    <span class="small">${u.email}</span>
  `;

  f.textContent = s.totalFlights || 0;
  d.textContent = s.totalDelay || 0;
  a.textContent = (s.avgDelay || 0).toFixed(1);
  sEl.textContent = `${(s.avgScore || 0).toFixed(1)}â­`;
});

logout.onclick = async ()=>{
  await signOut(auth);
  location.href="index.html";
};

document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>location.href=b.dataset.go;
});
</script>
</body>
</html>
