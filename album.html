<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Album â€¢ Ground Handling Log</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="container" style="padding-bottom:72px">
    <h2>ğŸ´ Sammelalbum</h2>
    <div class="card">
      <p class="small">Du bekommst automatisch eine Karte pro <strong>Flugzeugtyp + Airline</strong>, sobald du so einen Flug abfertigst.</p>
    </div>

    <div id="grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px"></div>
  </div>

  <nav>
    <button data-go="dashboard.html">ğŸ“Š</button>
    <button data-go="aircraft.html">âœˆï¸</button>
    <button class="active" data-go="album.html">ğŸ´</button>
    <button data-go="social.html">ğŸ‘¥</button>
  </nav>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, collection, query, where, orderBy, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCC9zB_me4qdyBmHZ0TeUDPB1WoPNa6e1A",
  authDomain: "ground-handling-log.firebaseapp.com",
  projectId: "ground-handling-log",
  appId: "1:771821879817:web:35ad14da4ab4613b832ed8"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const grid = document.getElementById("grid");

onAuthStateChanged(auth, async (user) => {
  if (!user) { location.href="index.html"; return; }

  const qy = query(
    collection(db,"flights"),
    where("userId","==",user.uid),
    orderBy("timestamp","desc")
  );
  const snap = await getDocs(qy);

  const map = new Map(); // key = type|airline
  snap.forEach(d=>{
    const f=d.data();
    const key = `${f.aircraftType} | ${f.airline}`;
    if (!map.has(key)){
      map.set(key, { aircraftType:f.aircraftType, airline:f.airline, count:0, special:false, livery:"" });
    }
    const c = map.get(key);
    c.count++;
    if (f.special){ c.special=true; c.livery=f.livery || c.livery; }
  });

  grid.innerHTML="";
  [...map.values()].sort((a,b)=>b.count-a.count).forEach(c=>{
    const div=document.createElement("div");
    div.className="card";
    div.innerHTML = `
      <div style="font-weight:900;font-size:18px">${c.aircraftType}</div>
      <div class="small">${c.airline}</div>
      <div class="small" style="margin-top:8px">Gesammelt: <strong>${c.count}Ã—</strong></div>
      <div style="margin-top:10px">${c.special ? `ğŸ¨ <span class="small">${c.livery || "Special"}</span>` : `<span class="small">Standard</span>`}</div>
    `;
    grid.appendChild(div);
  });

  if (!grid.children.length){
    grid.innerHTML = `<div class="card"><p class="small">Noch keine Karten. Trage eine Abfertigung im Dashboard ein.</p></div>`;
  }
});
</script>

<script>
document.querySelectorAll('nav button').forEach(b=>b.addEventListener('click',()=>location.href=b.dataset.go));
</script>
</body>
</html>
